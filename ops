{"author":{"id":"382e0604a0cc648df6764230ea7ce0b626217738167eb2200238272b6c52e2a8"},"ops":[{"type":3,"author":{"id":"382e0604a0cc648df6764230ea7ce0b626217738167eb2200238272b6c52e2a8"},"timestamp":1571165846,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MjM1NjMyNg==","github-url":"https://github.com/rurban/smhasher/issues/73#issuecomment-542356326"},"nonce":"kyaK+GcmNkpnPIIoMvoHwc2LepU=","message":"Thank you once more for all the testing, it takes time.\n\nThe results are unexpectedly low as if the SMHASHER was 32bit code!\n\nSaying FNV1A-Totenschiff is bad is funny to me, it is the fastest practical hasher for table lookups known to me, straight up. To challenge my statement, please provide a set of keys, corpus or whatever and a methodology of your choice, I will run it using Intel v19.0 and GCC 7.3.0 both on Ivy Bridge and Kaby Lake.\n\nRegarding 37.335 cycles/hash, I have a question, what is your understanding of ALL my benchmarks outspeeding WYHASH (while keeping collisions on par) which features half the cycles?!\n\nAllow me few remarks:\n- You rightfully stated FNV is for speed, I would add for best speeds;\n- I don't know what you are doing with that \\0 but within granularity 8 (as FNV1A-Totenschiff is) there is not a single multiplicatuion by it!\n- You must know that there are big penalties for reading DWORDs when not found in cacheS! So much so for QWORDs, I have i5 2nd, i7 3rd, and i5 7th generations. The first one Sandy Bridge is not suitable for testing high-speeds. I would run the '1001 Nights' on my Kaby Lake, but the benchmark needs 16GB RAM, on it I have only 8GB.\n\nDon't you see that we need **PRACTICAL speeds measured**, I am open to hear what you can say about making a proper speed measuring, what methodology you prefer. \nFor now, my choice (in Lookuperorama r.4) is to punish heavily hashers that tend to stack hashes onto certain slots by building in each slot a B-tree - the more collisions the more time penalties. In contrast, if the most basic benchmark is to be employed (hashing in small cycle all the positions of a given file and counting the collisions) then we CANNOT punish the worse dispersion - the speed will be a constant while not taking into account THE REAL-WORLD needs for evenly filled hash-table.\n\nLet's see a file full with \\0s:\n\n```\nFirst 512 bytes of: '(Dictionary_Specification_Language_..)_Hanyu_Cihai_new_Sea-of-Words_(Zho-Zho).dsl' 42,920,232 bytes:\n0000 ff fe 23 00 4e 00 41 00 4d 00 45 00 09 00 22 00 48 00 61 00 6e 00 79 00 75 00 20 00 43 00 69 00 ..#.N.A.M.E...\".H.a.n.y.u. .C.i.\n0020 68 00 61 00 69 00 20 00 2c 00 20 00 53 00 69 00 6d 00 70 00 20 00 28 00 43 00 68 00 2d 00 43 00 h.a.i. .,. .S.i.m.p. .(.C.h.-.C.\n0040 68 00 29 00 22 00 0d 00 0a 00 23 00 49 00 4e 00 44 00 45 00 58 00 5f 00 4c 00 41 00 4e 00 47 00 h.).\".....#.I.N.D.E.X._.L.A.N.G.\n0060 55 00 41 00 47 00 45 00 09 00 22 00 43 00 68 00 69 00 6e 00 65 00 73 00 65 00 22 00 0d 00 0a 00 U.A.G.E...\".C.h.i.n.e.s.e.\".....\n0080 23 00 43 00 4f 00 4e 00 54 00 45 00 4e 00 54 00 53 00 5f 00 4c 00 41 00 4e 00 47 00 55 00 41 00 #.C.O.N.T.E.N.T.S._.L.A.N.G.U.A.\n00a0 47 00 45 00 09 00 22 00 43 00 68 00 69 00 6e 00 65 00 73 00 65 00 22 00 0d 00 0a 00 23 00 49 00 G.E...\".C.h.i.n.e.s.e.\".....#.I.\n00c0 43 00 4f 00 4e 00 5f 00 46 00 49 00 4c 00 45 00 09 00 22 00 43 00 3a 00 5c 00 5c 00 55 00 73 00 C.O.N._.F.I.L.E...\".C.:.\\.\\.U.s.\n00e0 65 00 72 00 73 00 5c 00 5c 00 53 00 61 00 62 00 69 00 72 00 6a 00 61 00 6e 00 5c 00 5c 00 44 00 e.r.s.\\.\\.S.a.b.i.r.j.a.n.\\.\\.D.\n0100 65 00 73 00 6b 00 74 00 6f 00 70 00 5c 00 5c 00 48 00 61 00 6e 00 79 00 75 00 20 00 43 00 69 00 e.s.k.t.o.p.\\.\\.H.a.n.y.u. .C.i.\n0120 68 00 61 00 69 00 5c 00 5c 00 48 00 61 00 6e 00 79 00 75 00 5f 00 43 00 69 00 68 00 61 00 69 00 h.a.i.\\.\\.H.a.n.y.u._.C.i.h.a.i.\n0140 5f 00 6e 00 65 00 77 00 2e 00 62 00 6d 00 70 00 22 00 0d 00 0a 00 0d 00 0a 00 b1 03 04 5c bf 7e _.n.e.w...b.m.p.\"............\\.~\n0160 0d 00 0a 00 09 00 5b 00 74 00 72 00 6e 00 5d 00 b1 03 20 00 73 00 68 00 e8 00 20 00 78 00 69 00 ......[.t.r.n.]... .s.h... .x.i.\n0180 e0 00 6e 00 0d 00 0a 00 09 00 73 53 1a ff 3f 96 14 5c d5 6c 04 5c bf 7e 02 30 3e 65 04 5c 27 60 ..n.......sS..?..\\.l.\\.~.0\u003ee.\\'`\n01a0 69 72 28 8d 70 88 d8 53 f6 65 3e 65 04 5c fa 51 65 67 84 76 32 75 cd 79 92 7c 50 5b 41 6d 02 30 ir(.p..S.e\u003ee.\\.Qeg.v2u.y.|P[Am.0\n01c0 5f 4e eb 53 1c 20 32 75 cd 79 04 5c bf 7e 1d 20 02 30 5b 00 2f 00 74 00 72 00 6e 00 5d 00 0d 00 _N.S. 2u.y.\\.~. .0[./.t.r.n.]...\n01e0 0a 00 b1 03 92 7c 50 5b 0d 00 0a 00 09 00 5b 00 74 00 72 00 6e 00 5d 00 b1 03 20 00 6c 00 ec 00 .....|P[......[.t.r.n.]... .l...\n```\nThe benchmark needs 32GB (18GB for putting CIHAI into B-trees), I did it using SSD RAM and once again FNV1A-Totenschiff was faster than WYHASH:\n\n```\n-------------------------------------------------------------------------------------------------------------------------------------------------\n| Hasher                                   | Number Of Hash Collisions =        | Number Of Trees,     | Number Of LEAFs, (littler THE BETTER)  |\n|                                          | (Distinct KEYs - Number Of Trees)  | (GREATER THE BETTER) | not counting ROOT LEAFs                |\n-------------------------------------------------------------------------------------------------------------------------------------------------\n| Lookuperorama_ICC_WY.exe, 24bit          |                        111,682,513 |          112,117,444 |                             63,925,202 |\n| Lookuperorama_ICC_Totenschiff.exe, 24bit |                        111,833,260 |          111,966,697 |                             64,085,673 |\n-------------------------------------------------------------------------------------------------------------------------------------------------\n| Lookuperorama_ICC_WY.exe, 25bit          |                         71,345,349 |          152,454,608 |                             29,983,843 |\n| Lookuperorama_ICC_Totenschiff.exe, 25bit |                         71,536,395 |          152,263,562 |                             30,180,703 |\n-------------------------------------------------------------------------------------------------------------------------------------------------\n| Lookuperorama_ICC_WY.exe, 26bit          |                         41,105,637 |          182,694,320 |                             10,761,252 |\n| Lookuperorama_ICC_Totenschiff.exe, 26bit |                         41,265,947 |          182,534,010 |                             10,874,209 |\n-------------------------------------------------------------------------------------------------------------------------------------------------\n```","files":null}]}