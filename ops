{"author":{"id":"778d0d8adcf381faef152a6577de9902e431612075f7585af0b6ac9d7d1c1475"},"ops":[{"type":1,"author":{"id":"778d0d8adcf381faef152a6577de9902e431612075f7585af0b6ac9d7d1c1475"},"timestamp":1553221139,"metadata":{"github-id":"MDU6SXNzdWU0MjQwMTgxNTI=","github-url":"https://github.com/rurban/smhasher/issues/65","origin":"github"},"nonce":"YfsTQWcCtv9gG/28Qmefbme42sg=","title":"Moment test breaks several hashes including xxh3","message":"#include\t\u003csys/time.h\u003e\nvoid MomentTest ( pfHash hash){\n\tprintf(\"Running MomentTest...\\n\");\n\tunsigned\tk=0,\ts=0;\n\tunsigned long long l,\th,\ta=0,\tb=0,\tx;\n\ttimeval\tbeg,\tend;\n\tgettimeofday(\u0026beg,NULL);\n\thash(\u0026k,4,s,\u0026l);\tfor(unsigned\ti=1;\ti\u003e0;\ti++){\thash(\u0026i,4,s,\u0026h);\tx=__builtin_popcountll(l^h);\ta+=x*x*x*x*x;\tl=h;\t}\n\thash(\u0026k,4,s,\u0026l);\tfor(unsigned\ti=1;\ti\u003e0;\ti++){\thash(\u0026k,4,i,\u0026h);\tx=__builtin_popcountll(l^h);\tb+=x*x*x*x*x;\tl=h;\t}\n\tgettimeofday(\u0026end,NULL);\n\tprintf(\"KeySeedMomentBias:\\t%g\\n\",\tfabs((double)a/0xffffffff-(double)b/0xffffffff));\t\n\tprintf(\"MomentTime\\t%g ns/hash\\n\",(end.tv_sec-beg.tv_sec+1e-6*(end.tv_usec-beg.tv_usec))/0x200000000ull*1e9);\n}\n\n64bit hash functions:\nt1ha2_atonce\t68.3427\tPASS\nxxHash64\t199.237\tPASS\nMUM\t401.8\tPASS\nwyhash\t418.321\tPASS\nfarmhash64_c\t536.879\tPASS\nSipHash\t807.371\tPASS\n//SipHash hints the lower bound of cutoff \n(c)metrohash64_2\t969.287\tPASS\nSpooky64\t1996.32\tPASS\n//maybe 10000 is good cutoff\n(c)metrohash64_1\t13612.2\tFAIL\nfasthash64\t65498.9\tFAIL\nxxh3\t181411\tFAIL\n\n//32 bit hash with fifth momoent should have 1/32.0 cutoff\n32bit hash functions:\nGoodOAAT\t1.04201\tPASS\nMUMlow:\t1.24215\tPASS\nCity32\t4.71543\tPASS\nwyhash32low\t26.9434\tPASS\n//SipHash/32.0 hints the lower bound of cutoff\nfasthash32\t34.4996\tPASS\nCity64low\t54.8737\tPASS\nSpooky32\t155.019\tPASS\n//10000/32.0=340\nxxHash32\t486.913\tFAIL\nMurmur3A\t8132.47\tFAIL\nPMurHash32\t8132.47\tFAIL","files":null}]}